<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:fn="http://java.sun.com/jsp/jstl/functions">

<h:head>
    <title><ui:insert name="titulo"> SIAAS</ui:insert></title>

    <!-- ===== FAVICON ===== -->
    <link rel="icon" type="image/png"
          href="#{resource['img/favicon.png']}" />
    <link rel="shortcut icon" type="image/x-icon"
          href="#{resource['img/iepi.ico']}" />

    <!-- ===== ESTILOS ===== -->
    <h:outputStylesheet library="css" name="estilo.css" />
</h:head>

<h:body>

    <!-- ✅ view actual (JSF real) -->
    <ui:param name="viewId" value="#{facesContext.viewRoot.viewId}" />

    <div class="dashboard">

        <!-- ===== SIDEBAR ===== -->
        <aside class="sidebar">

            <div class="sidebar-header">
                <h3 style="font-size: 18px; font-weight: 700; line-height: 1.2;">
                    Sistema Institucional de Autorización de Accesos
                </h3>
            </div>

            <nav class="sidebar-nav">
                <ul id="menu">

                    <!-- OPCIONES COMUNES -->
                    <li>
                        <h:link outcome="/home"
                                styleClass="#{viewId eq '/home.xhtml' ? 'active' : ''}">
                            <span class="menu-label">Inicio</span>
                        </h:link>
                    </li>

                    <!-- ✅ SOLO se marca cuando es el index de Solicitud -->
                    <li>
                        <h:link outcome="/Solicitud/index"
                                styleClass="#{viewId eq '/Solicitud/index.xhtml' ? 'active' : ''}">
                            <span class="menu-label">Solicitudes</span>
                        </h:link>
                    </li>

                    <!-- RESPONSABLE DE ACCESOS -->
                    <h:panelGroup rendered="#{fn:toLowerCase(loginBean.usuario.cargo) eq 'responsable accesos'}">
                        <li>
                            <h:link outcome="/Solicitud/pendientesAccesos"
                                    styleClass="#{fn:contains(viewId, '/Solicitud/pendientesAccesos') ? 'active' : ''}">
                                <span class="menu-label">Solicitudes por aplicar</span>

                                <!-- ✅ badge (INLINE para que no baje) -->
                                <h:panelGroup layout="inline"
                                              rendered="#{solicitudesPendientesBean.pendientesPorAplicarCount gt 0}">
                                    <span class="badge">#{solicitudesPendientesBean.pendientesPorAplicarCount}</span>
                                </h:panelGroup>
                            </h:link>
                        </li>

                        <li>
                            <h:link outcome="/Reportes/index"
                                    styleClass="#{fn:contains(viewId, '/Reportes/') ? 'active' : ''}">
                                <span class="menu-label">Reportes de accesos aplicados</span>
                            </h:link>
                        </li>
                    </h:panelGroup>

                    <!-- DIRECTOR -->
                    <h:panelGroup rendered="#{fn:toLowerCase(loginBean.usuario.cargo) eq 'director'}">
                        <li>
                            <h:link outcome="/Solicitud/pendientes"
                                    styleClass="#{fn:contains(viewId, '/Solicitud/pendientes') ? 'active' : ''}">
                                <span class="menu-label">Solicitudes Pendientes</span>

                                <!-- ✅ badge (INLINE para que no baje) -->
                                <h:panelGroup layout="inline"
                                              rendered="#{solicitudesPendientesBean.pendientesFirmaCount gt 0}">
                                    <span class="badge">#{solicitudesPendientesBean.pendientesFirmaCount}</span>
                                </h:panelGroup>
                            </h:link>
                        </li>

                        <li>
                            <h:link outcome="/Reportes/index"
                                    styleClass="#{fn:contains(viewId, '/Reportes/') ? 'active' : ''}">
                                <span class="menu-label">Reportes</span>
                            </h:link>
                        </li>
                    </h:panelGroup>

                    <!-- DIRECTOR TIC -->
                    <h:panelGroup rendered="#{fn:toLowerCase(loginBean.usuario.cargo) eq 'director tic'}">
                        <li>
                            <h:link outcome="/Solicitud/pendientes"
                                    styleClass="#{fn:contains(viewId, '/Solicitud/pendientes') ? 'active' : ''}">
                                <span class="menu-label">Solicitudes Pendientes</span>

                                <!-- ✅ badge (INLINE para que no baje) -->
                                <h:panelGroup layout="inline"
                                              rendered="#{solicitudesPendientesBean.pendientesFirmaCount gt 0}">
                                    <span class="badge">#{solicitudesPendientesBean.pendientesFirmaCount}</span>
                                </h:panelGroup>
                            </h:link>
                        </li>

                        <li>
                            <h:link outcome="/Reportes/index"
                                    styleClass="#{(fn:contains(viewId, '/Reportes/') and param.tipo eq 'tic') ? 'active' : ''}">
                                <f:param name="tipo" value="tic" />
                                <span class="menu-label">Reportes Dirección TIC</span>
                            </h:link>
                        </li>

                        <li>
                            <h:link outcome="/Reportes/index"
                                    styleClass="#{(fn:contains(viewId, '/Reportes/') and param.tipo eq 'oficial') ? 'active' : ''}">
                                <f:param name="tipo" value="oficial" />
                                <span class="menu-label">Reportes Oficial Seguridad</span>
                            </h:link>
                        </li>
                    </h:panelGroup>

                    <!-- ADMINISTRADOR -->
                    <h:panelGroup rendered="#{fn:toLowerCase(loginBean.usuario.cargo) eq 'administrador'}">
                        <li>
                            <h:link outcome="/Usuario/index"
                                    styleClass="#{fn:contains(viewId, '/Usuario/') ? 'active' : ''}">
                                <span class="menu-label">Gestión de Usuarios</span>
                            </h:link>
                        </li>

                        <li>
                            <h:link outcome="/UsuarioRol/index"
                                    styleClass="#{fn:contains(viewId, '/UsuarioRol/') ? 'active' : ''}">
                                <span class="menu-label">Asignación de Rol</span>
                            </h:link>
                        </li>

                        <li>
                            <h:link outcome="/Aplicacion/index"
                                    styleClass="#{fn:contains(viewId, '/Aplicacion/') ? 'active' : ''}">
                                <span class="menu-label">Gestión de Aplicaciones</span>
                            </h:link>
                        </li>

                        <li>
                            <h:link outcome="/PermisoAplicacion/index"
                                    styleClass="#{fn:contains(viewId, '/PermisoAplicacion/') ? 'active' : ''}">
                                <span class="menu-label">Permisos de Aplicaciones</span>
                            </h:link>
                        </li>

                        <li>
                            <h:link outcome="/Auditoria/index"
                                    styleClass="#{fn:contains(viewId, '/Auditoria/') ? 'active' : ''}">
                                <span class="menu-label">Auditoría del Sistema</span>
                            </h:link>
                        </li>
                    </h:panelGroup>

                </ul>
            </nav>

            <!-- CERRAR SESIÓN -->
            <div class="sidebar-logout">
                <h:form id="logoutForm">
                    <h:commandButton id="logoutBtn"
                                     value="Cerrar Sesión"
                                     action="#{loginBean.logout}"
                                     styleClass="btn-logout"
                                     ajax="false" />
                </h:form>
            </div>

        </aside>

        <!-- ===== CONTENIDO PRINCIPAL ===== -->
        <main class="main-content">

            <header class="main-header">
                <h:graphicImage library="img"
                                name="logo.jpeg"
                                styleClass="main-header-logo"
                                alt="Logo institucional" />

                <div class="main-header-user">
                    <h2>
                        Bienvenido,
                        #{loginBean.usuario.nombre}
                        #{loginBean.usuario.apellido}
                    </h2>

                    <p>
                        Correo: #{loginBean.usuario.correo}
                        <span style="margin: 0 10px;">·</span>
                        Cargo: #{loginBean.usuario.cargo}
                    </p>
                </div>
            </header>

            <section class="content">
                <ui:insert name="contenido" />
            </section>

        </main>

    </div>

</h:body>
</html>
