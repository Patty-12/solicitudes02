<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:fn="http://java.sun.com/jsp/jstl/functions">

<h:head>
    <title><ui:insert name="titulo"> SIAAS</ui:insert></title>

    <!-- ===== FAVICON ===== -->
    <link rel="icon" type="image/png"
          href="#{resource['img/favicon.png']}" />
    <link rel="shortcut icon" type="image/x-icon"
          href="#{resource['img/iepi.ico']}" />

    <!-- ===== ESTILOS ===== -->
    <h:outputStylesheet library="css" name="estilo.css" />
</h:head>

<h:body>

    <!-- ruta actual real -->
    <ui:param name="path" value="#{request.servletPath}" />

    <div class="dashboard">

        <!-- ===== SIDEBAR ===== -->
        <aside class="sidebar">

            <div class="sidebar-header">
                <h3 style="font-size: 18px; font-weight: 700; line-height: 1.2;">
                    Solicitud de Permisos
                </h3>
            </div>

            <nav class="sidebar-nav">
                <ul id="menu">

                    <!-- OPCIONES COMUNES -->
                    <li>
                        <h:link outcome="/home" value="Inicio"
                                styleClass="#{path eq '/home.xhtml' ? 'active' : ''}" />
                    </li>

                    <li>
                        <h:link outcome="/Solicitud/index" value="Solicitudes"
                                styleClass="#{fn:contains(path, '/Solicitud/') ? 'active' : ''}" />
                    </li>

                    <!-- RESPONSABLE DE ACCESOS -->
                    <h:panelGroup rendered="#{fn:toLowerCase(loginBean.usuario.cargo) eq 'responsable accesos'}">
                        <li>
                            <h:link outcome="/Solicitud/pendientesAccesos"
                                    value="Solicitudes por aplicar"
                                    styleClass="#{fn:contains(path, '/Solicitud/pendientesAccesos') ? 'active' : ''}" />
                        </li>

                        <li>
                            <h:link outcome="/Reportes/index"
                                    value="Reportes de accesos aplicados"
                                    styleClass="#{fn:contains(path, '/Reportes/') ? 'active' : ''}" />
                        </li>
                    </h:panelGroup>

                    <!-- DIRECTOR -->
                    <h:panelGroup rendered="#{fn:toLowerCase(loginBean.usuario.cargo) eq 'director'}">
                        <li>
                            <h:link outcome="/Solicitud/pendientes"
                                    value="Solicitudes Pendientes"
                                    styleClass="#{fn:contains(path, '/Solicitud/pendientes') ? 'active' : ''}" />
                        </li>

                        <li>
                            <h:link outcome="/Reportes/index"
                                    value="Reportes"
                                    styleClass="#{fn:contains(path, '/Reportes/') ? 'active' : ''}" />
                        </li>
                    </h:panelGroup>

                    <!-- DIRECTOR TIC -->
                    <h:panelGroup rendered="#{fn:toLowerCase(loginBean.usuario.cargo) eq 'director tic'}">
                        <li>
                            <h:link outcome="/Solicitud/pendientes"
                                    value="Solicitudes Pendientes"
                                    styleClass="#{fn:contains(path, '/Solicitud/pendientes') ? 'active' : ''}" />
                        </li>

                        <li>
                            <h:link outcome="/Reportes/index"
                                    value="Reportes Dirección TIC"
                                    styleClass="#{(fn:contains(path, '/Reportes/') and param.tipo eq 'tic') ? 'active' : ''}">
                                <f:param name="tipo" value="tic" />
                            </h:link>
                        </li>

                        <li>
                            <h:link outcome="/Reportes/index"
                                    value="Reportes Oficial Seguridad"
                                    styleClass="#{(fn:contains(path, '/Reportes/') and param.tipo eq 'oficial') ? 'active' : ''}">
                                <f:param name="tipo" value="oficial" />
                            </h:link>
                        </li>
                    </h:panelGroup>

                    <!-- ADMINISTRADOR -->
                    <h:panelGroup rendered="#{fn:toLowerCase(loginBean.usuario.cargo) eq 'administrador'}">
                        <li>
                            <h:link outcome="/Usuario/index" value="Gestión de Usuarios"
                                    styleClass="#{fn:contains(path, '/Usuario/') ? 'active' : ''}" />
                        </li>

                        <li>
                            <h:link outcome="/UsuarioRol/index" value="Asignación de Rol"
                                    styleClass="#{fn:contains(path, '/UsuarioRol/') ? 'active' : ''}" />
                        </li>

                        <li>
                            <h:link outcome="/Aplicacion/index" value="Gestión de Aplicaciones"
                                    styleClass="#{fn:contains(path, '/Aplicacion/') ? 'active' : ''}" />
                        </li>

                        <li>
                            <h:link outcome="/PermisoAplicacion/index" value="Permisos de Aplicaciones"
                                    styleClass="#{fn:contains(path, '/PermisoAplicacion/') ? 'active' : ''}" />
                        </li>

                        <li>
                            <h:link outcome="/Auditoria/index" value="Auditoría del Sistema"
                                    styleClass="#{fn:contains(path, '/Auditoria/') ? 'active' : ''}" />
                        </li>
                    </h:panelGroup>

                </ul>
            </nav>

            <!-- CERRAR SESIÓN -->
            <div class="sidebar-logout">
                <h:form id="logoutForm">
                    <h:commandButton id="logoutBtn"
                                     value="Cerrar Sesión"
                                     action="#{loginBean.logout}"
                                     styleClass="btn-logout"
                                     ajax="false" />
                </h:form>
            </div>

        </aside>

        <!-- ===== CONTENIDO PRINCIPAL ===== -->
        <main class="main-content">

            <header class="main-header">
                <h:graphicImage library="img"
                                name="logo.jpeg"
                                styleClass="main-header-logo"
                                alt="Logo institucional" />

                <div class="main-header-user">
                    <h2>
                        Bienvenido,
                        #{loginBean.usuario.nombre}
                        #{loginBean.usuario.apellido}
                    </h2>

                    <p>
                        Correo: #{loginBean.usuario.correo}
                        <span style="margin: 0 10px;">·</span>
                        Cargo: #{loginBean.usuario.cargo}
                    </p>
                </div>
            </header>

            <section class="content">
                <ui:insert name="contenido" />
            </section>

        </main>

    </div>

</h:body>
</html>
